'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var cov_ao7cemh8n = function () {
  var path = '/home/ubuntu/atscm-cli/src/cli/commands/Init.js',
      hash = 'ba8cbbe5a9998da2f727c3225d0ab66d16df5fb1',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/home/ubuntu/atscm-cli/src/cli/commands/Init.js',
    statementMap: {
      '0': {
        start: {
          line: 11,
          column: 21
        },
        end: {
          line: 11,
          column: 47
        }
      },
      '1': {
        start: {
          line: 26,
          column: 4
        },
        end: {
          line: 42,
          column: 7
        }
      },
      '2': {
        start: {
          line: 27,
          column: 6
        },
        end: {
          line: 41,
          column: 9
        }
      },
      '3': {
        start: {
          line: 28,
          column: 8
        },
        end: {
          line: 40,
          column: 9
        }
      },
      '4': {
        start: {
          line: 29,
          column: 10
        },
        end: {
          line: 35,
          column: 11
        }
      },
      '5': {
        start: {
          line: 30,
          column: 12
        },
        end: {
          line: 30,
          column: 76
        }
      },
      '6': {
        start: {
          line: 31,
          column: 17
        },
        end: {
          line: 35,
          column: 11
        }
      },
      '7': {
        start: {
          line: 32,
          column: 12
        },
        end: {
          line: 32,
          column: 80
        }
      },
      '8': {
        start: {
          line: 34,
          column: 12
        },
        end: {
          line: 34,
          column: 24
        }
      },
      '9': {
        start: {
          line: 36,
          column: 15
        },
        end: {
          line: 40,
          column: 9
        }
      },
      '10': {
        start: {
          line: 36,
          column: 37
        },
        end: {
          line: 36,
          column: 76
        }
      },
      '11': {
        start: {
          line: 37,
          column: 10
        },
        end: {
          line: 37,
          column: 72
        }
      },
      '12': {
        start: {
          line: 39,
          column: 10
        },
        end: {
          line: 39,
          column: 24
        }
      },
      '13': {
        start: {
          line: 51,
          column: 4
        },
        end: {
          line: 63,
          column: 7
        }
      },
      '14': {
        start: {
          line: 52,
          column: 6
        },
        end: {
          line: 62,
          column: 9
        }
      },
      '15': {
        start: {
          line: 53,
          column: 8
        },
        end: {
          line: 61,
          column: 9
        }
      },
      '16': {
        start: {
          line: 55,
          column: 10
        },
        end: {
          line: 58,
          column: 14
        }
      },
      '17': {
        start: {
          line: 60,
          column: 10
        },
        end: {
          line: 60,
          column: 20
        }
      },
      '18': {
        start: {
          line: 73,
          column: 4
        },
        end: {
          line: 91,
          column: 7
        }
      },
      '19': {
        start: {
          line: 74,
          column: 6
        },
        end: {
          line: 90,
          column: 9
        }
      },
      '20': {
        start: {
          line: 75,
          column: 8
        },
        end: {
          line: 89,
          column: 9
        }
      },
      '21': {
        start: {
          line: 76,
          column: 10
        },
        end: {
          line: 76,
          column: 22
        }
      },
      '22': {
        start: {
          line: 78,
          column: 24
        },
        end: {
          line: 86,
          column: 14
        }
      },
      '23': {
        start: {
          line: 79,
          column: 35
        },
        end: {
          line: 79,
          column: 49
        }
      },
      '24': {
        start: {
          line: 81,
          column: 14
        },
        end: {
          line: 85,
          column: 15
        }
      },
      '25': {
        start: {
          line: 82,
          column: 16
        },
        end: {
          line: 82,
          column: 71
        }
      },
      '26': {
        start: {
          line: 84,
          column: 16
        },
        end: {
          line: 84,
          column: 26
        }
      },
      '27': {
        start: {
          line: 88,
          column: 10
        },
        end: {
          line: 88,
          column: 44
        }
      },
      '28': {
        start: {
          line: 100,
          column: 4
        },
        end: {
          line: 100,
          column: 57
        }
      },
      '29': {
        start: {
          line: 103,
          column: 4
        },
        end: {
          line: 103,
          column: 39
        }
      },
      '30': {
        start: {
          line: 114,
          column: 4
        },
        end: {
          line: 114,
          column: 50
        }
      },
      '31': {
        start: {
          line: 116,
          column: 21
        },
        end: {
          line: 116,
          column: 59
        }
      },
      '32': {
        start: {
          line: 117,
          column: 4
        },
        end: {
          line: 122,
          column: 5
        }
      },
      '33': {
        start: {
          line: 118,
          column: 6
        },
        end: {
          line: 118,
          column: 96
        }
      },
      '34': {
        start: {
          line: 119,
          column: 6
        },
        end: {
          line: 119,
          column: 97
        }
      },
      '35': {
        start: {
          line: 121,
          column: 6
        },
        end: {
          line: 121,
          column: 74
        }
      },
      '36': {
        start: {
          line: 124,
          column: 4
        },
        end: {
          line: 124,
          column: 15
        }
      },
      '37': {
        start: {
          line: 134,
          column: 4
        },
        end: {
          line: 134,
          column: 67
        }
      },
      '38': {
        start: {
          line: 137,
          column: 20
        },
        end: {
          line: 137,
          column: 72
        }
      },
      '39': {
        start: {
          line: 139,
          column: 4
        },
        end: {
          line: 139,
          column: 27
        }
      },
      '40': {
        start: {
          line: 154,
          column: 4
        },
        end: {
          line: 154,
          column: 70
        }
      },
      '41': {
        start: {
          line: 164,
          column: 4
        },
        end: {
          line: 164,
          column: 46
        }
      },
      '42': {
        start: {
          line: 166,
          column: 4
        },
        end: {
          line: 166,
          column: 36
        }
      },
      '43': {
        start: {
          line: 174,
          column: 4
        },
        end: {
          line: 189,
          column: 9
        }
      },
      '44': {
        start: {
          line: 175,
          column: 19
        },
        end: {
          line: 175,
          column: 47
        }
      },
      '45': {
        start: {
          line: 176,
          column: 18
        },
        end: {
          line: 176,
          column: 62
        }
      },
      '46': {
        start: {
          line: 177,
          column: 18
        },
        end: {
          line: 177,
          column: 56
        }
      },
      '47': {
        start: {
          line: 178,
          column: 18
        },
        end: {
          line: 178,
          column: 38
        }
      },
      '48': {
        start: {
          line: 179,
          column: 19
        },
        end: {
          line: 179,
          column: 44
        }
      },
      '49': {
        start: {
          line: 180,
          column: 19
        },
        end: {
          line: 180,
          column: 41
        }
      },
      '50': {
        start: {
          line: 181,
          column: 18
        },
        end: {
          line: 181,
          column: 61
        }
      },
      '51': {
        start: {
          line: 182,
          column: 23
        },
        end: {
          line: 185,
          column: 7
        }
      },
      '52': {
        start: {
          line: 186,
          column: 22
        },
        end: {
          line: 186,
          column: 83
        }
      },
      '53': {
        start: {
          line: 188,
          column: 8
        },
        end: {
          line: 188,
          column: 87
        }
      },
      '54': {
        start: {
          line: 197,
          column: 4
        },
        end: {
          line: 197,
          column: 17
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 25,
            column: 2
          },
          end: {
            line: 25,
            column: 3
          }
        },
        loc: {
          start: {
            line: 25,
            column: 23
          },
          end: {
            line: 43,
            column: 3
          }
        }
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 26,
            column: 23
          },
          end: {
            line: 26,
            column: 24
          }
        },
        loc: {
          start: {
            line: 26,
            column: 44
          },
          end: {
            line: 42,
            column: 5
          }
        }
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 27,
            column: 20
          },
          end: {
            line: 27,
            column: 21
          }
        },
        loc: {
          start: {
            line: 27,
            column: 36
          },
          end: {
            line: 41,
            column: 7
          }
        }
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 36,
            column: 32
          },
          end: {
            line: 36,
            column: 33
          }
        },
        loc: {
          start: {
            line: 36,
            column: 37
          },
          end: {
            line: 36,
            column: 76
          }
        }
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 50,
            column: 2
          },
          end: {
            line: 50,
            column: 3
          }
        },
        loc: {
          start: {
            line: 50,
            column: 27
          },
          end: {
            line: 64,
            column: 3
          }
        }
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 51,
            column: 23
          },
          end: {
            line: 51,
            column: 24
          }
        },
        loc: {
          start: {
            line: 51,
            column: 44
          },
          end: {
            line: 63,
            column: 5
          }
        }
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 52,
            column: 50
          },
          end: {
            line: 52,
            column: 51
          }
        },
        loc: {
          start: {
            line: 52,
            column: 57
          },
          end: {
            line: 62,
            column: 7
          }
        }
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 72,
            column: 2
          },
          end: {
            line: 72,
            column: 3
          }
        },
        loc: {
          start: {
            line: 72,
            column: 26
          },
          end: {
            line: 92,
            column: 3
          }
        }
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 73,
            column: 23
          },
          end: {
            line: 73,
            column: 24
          }
        },
        loc: {
          start: {
            line: 73,
            column: 44
          },
          end: {
            line: 91,
            column: 5
          }
        }
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 74,
            column: 19
          },
          end: {
            line: 74,
            column: 20
          }
        },
        loc: {
          start: {
            line: 74,
            column: 33
          },
          end: {
            line: 90,
            column: 7
          }
        }
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 79,
            column: 25
          },
          end: {
            line: 79,
            column: 26
          }
        },
        loc: {
          start: {
            line: 79,
            column: 35
          },
          end: {
            line: 79,
            column: 49
          }
        }
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 80,
            column: 25
          },
          end: {
            line: 80,
            column: 26
          }
        },
        loc: {
          start: {
            line: 80,
            column: 33
          },
          end: {
            line: 86,
            column: 13
          }
        }
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 99,
            column: 2
          },
          end: {
            line: 99,
            column: 3
          }
        },
        loc: {
          start: {
            line: 99,
            column: 21
          },
          end: {
            line: 104,
            column: 3
          }
        }
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 113,
            column: 2
          },
          end: {
            line: 113,
            column: 3
          }
        },
        loc: {
          start: {
            line: 113,
            column: 23
          },
          end: {
            line: 125,
            column: 3
          }
        }
      },
      '14': {
        name: '(anonymous_14)',
        decl: {
          start: {
            line: 133,
            column: 2
          },
          end: {
            line: 133,
            column: 3
          }
        },
        loc: {
          start: {
            line: 133,
            column: 25
          },
          end: {
            line: 140,
            column: 3
          }
        }
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 152,
            column: 2
          },
          end: {
            line: 152,
            column: 3
          }
        },
        loc: {
          start: {
            line: 152,
            column: 34
          },
          end: {
            line: 155,
            column: 3
          }
        }
      },
      '16': {
        name: '(anonymous_16)',
        decl: {
          start: {
            line: 163,
            column: 2
          },
          end: {
            line: 163,
            column: 3
          }
        },
        loc: {
          start: {
            line: 163,
            column: 34
          },
          end: {
            line: 167,
            column: 3
          }
        }
      },
      '17': {
        name: '(anonymous_17)',
        decl: {
          start: {
            line: 173,
            column: 2
          },
          end: {
            line: 173,
            column: 3
          }
        },
        loc: {
          start: {
            line: 173,
            column: 11
          },
          end: {
            line: 190,
            column: 3
          }
        }
      },
      '18': {
        name: '(anonymous_18)',
        decl: {
          start: {
            line: 175,
            column: 12
          },
          end: {
            line: 175,
            column: 13
          }
        },
        loc: {
          start: {
            line: 175,
            column: 19
          },
          end: {
            line: 175,
            column: 47
          }
        }
      },
      '19': {
        name: '(anonymous_19)',
        decl: {
          start: {
            line: 176,
            column: 12
          },
          end: {
            line: 176,
            column: 13
          }
        },
        loc: {
          start: {
            line: 176,
            column: 18
          },
          end: {
            line: 176,
            column: 62
          }
        }
      },
      '20': {
        name: '(anonymous_20)',
        decl: {
          start: {
            line: 177,
            column: 12
          },
          end: {
            line: 177,
            column: 13
          }
        },
        loc: {
          start: {
            line: 177,
            column: 18
          },
          end: {
            line: 177,
            column: 56
          }
        }
      },
      '21': {
        name: '(anonymous_21)',
        decl: {
          start: {
            line: 178,
            column: 12
          },
          end: {
            line: 178,
            column: 13
          }
        },
        loc: {
          start: {
            line: 178,
            column: 18
          },
          end: {
            line: 178,
            column: 38
          }
        }
      },
      '22': {
        name: '(anonymous_22)',
        decl: {
          start: {
            line: 179,
            column: 12
          },
          end: {
            line: 179,
            column: 13
          }
        },
        loc: {
          start: {
            line: 179,
            column: 19
          },
          end: {
            line: 179,
            column: 44
          }
        }
      },
      '23': {
        name: '(anonymous_23)',
        decl: {
          start: {
            line: 180,
            column: 12
          },
          end: {
            line: 180,
            column: 13
          }
        },
        loc: {
          start: {
            line: 180,
            column: 19
          },
          end: {
            line: 180,
            column: 41
          }
        }
      },
      '24': {
        name: '(anonymous_24)',
        decl: {
          start: {
            line: 181,
            column: 12
          },
          end: {
            line: 181,
            column: 13
          }
        },
        loc: {
          start: {
            line: 181,
            column: 18
          },
          end: {
            line: 181,
            column: 61
          }
        }
      },
      '25': {
        name: '(anonymous_25)',
        decl: {
          start: {
            line: 182,
            column: 12
          },
          end: {
            line: 182,
            column: 13
          }
        },
        loc: {
          start: {
            line: 182,
            column: 23
          },
          end: {
            line: 185,
            column: 7
          }
        }
      },
      '26': {
        name: '(anonymous_26)',
        decl: {
          start: {
            line: 186,
            column: 12
          },
          end: {
            line: 186,
            column: 13
          }
        },
        loc: {
          start: {
            line: 186,
            column: 22
          },
          end: {
            line: 186,
            column: 83
          }
        }
      },
      '27': {
        name: '(anonymous_27)',
        decl: {
          start: {
            line: 187,
            column: 12
          },
          end: {
            line: 187,
            column: 13
          }
        },
        loc: {
          start: {
            line: 187,
            column: 18
          },
          end: {
            line: 189,
            column: 7
          }
        }
      },
      '28': {
        name: '(anonymous_28)',
        decl: {
          start: {
            line: 196,
            column: 2
          },
          end: {
            line: 196,
            column: 3
          }
        },
        loc: {
          start: {
            line: 196,
            column: 24
          },
          end: {
            line: 198,
            column: 3
          }
        }
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 28,
            column: 8
          },
          end: {
            line: 40,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 28,
            column: 8
          },
          end: {
            line: 40,
            column: 9
          }
        }, {
          start: {
            line: 28,
            column: 8
          },
          end: {
            line: 40,
            column: 9
          }
        }]
      },
      '1': {
        loc: {
          start: {
            line: 29,
            column: 10
          },
          end: {
            line: 35,
            column: 11
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 29,
            column: 10
          },
          end: {
            line: 35,
            column: 11
          }
        }, {
          start: {
            line: 29,
            column: 10
          },
          end: {
            line: 35,
            column: 11
          }
        }]
      },
      '2': {
        loc: {
          start: {
            line: 31,
            column: 17
          },
          end: {
            line: 35,
            column: 11
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 31,
            column: 17
          },
          end: {
            line: 35,
            column: 11
          }
        }, {
          start: {
            line: 31,
            column: 17
          },
          end: {
            line: 35,
            column: 11
          }
        }]
      },
      '3': {
        loc: {
          start: {
            line: 36,
            column: 15
          },
          end: {
            line: 40,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 36,
            column: 15
          },
          end: {
            line: 40,
            column: 9
          }
        }, {
          start: {
            line: 36,
            column: 15
          },
          end: {
            line: 40,
            column: 9
          }
        }]
      },
      '4': {
        loc: {
          start: {
            line: 53,
            column: 8
          },
          end: {
            line: 61,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 53,
            column: 8
          },
          end: {
            line: 61,
            column: 9
          }
        }, {
          start: {
            line: 53,
            column: 8
          },
          end: {
            line: 61,
            column: 9
          }
        }]
      },
      '5': {
        loc: {
          start: {
            line: 75,
            column: 8
          },
          end: {
            line: 89,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 75,
            column: 8
          },
          end: {
            line: 89,
            column: 9
          }
        }, {
          start: {
            line: 75,
            column: 8
          },
          end: {
            line: 89,
            column: 9
          }
        }]
      },
      '6': {
        loc: {
          start: {
            line: 81,
            column: 14
          },
          end: {
            line: 85,
            column: 15
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 81,
            column: 14
          },
          end: {
            line: 85,
            column: 15
          }
        }, {
          start: {
            line: 81,
            column: 14
          },
          end: {
            line: 85,
            column: 15
          }
        }]
      },
      '7': {
        loc: {
          start: {
            line: 117,
            column: 4
          },
          end: {
            line: 122,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 117,
            column: 4
          },
          end: {
            line: 122,
            column: 5
          }
        }, {
          start: {
            line: 117,
            column: 4
          },
          end: {
            line: 122,
            column: 5
          }
        }]
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0,
      '51': 0,
      '52': 0,
      '53': 0,
      '54': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

var _fs = require('fs');

var _path = require('path');

var _child_process = require('child_process');

var _which = require('which');

var _which2 = _interopRequireDefault(_which);

var _inquirer = require('inquirer');

var _semver = require('semver');

var _Command = require('../../lib/cli/Command');

var _Command2 = _interopRequireDefault(_Command);

var _Logger = require('../../lib/util/Logger');

var _Logger2 = _interopRequireDefault(_Logger);

var _package = require('../../../package.json');

var _package2 = _interopRequireDefault(_package);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const IgnoredFiles = (++cov_ao7cemh8n.s[0], ['.ds_store', 'thumbs.db']);

/**
 * The command invoked when running "init".
 */
class InitCommand extends _Command2.default {

  /**
   * Checks if the given path contains an empty directory. OS specific temporary files (.DS_Store
   * under macOS, thumbs.db under Windows) are ignored.
   * @param {String} path The path to check.
   * @return {Promise<String, Error>} Fulfilled with the valid directory's path, rejected if `path`
   * contains no or a non-empty directory.
   */
  checkDirectory(path) {
    ++cov_ao7cemh8n.f[0];
    ++cov_ao7cemh8n.s[1];

    return new Promise((resolve, reject) => {
      ++cov_ao7cemh8n.f[1];
      ++cov_ao7cemh8n.s[2];

      (0, _fs.readdir)(path, (err, files) => {
        ++cov_ao7cemh8n.f[2];
        ++cov_ao7cemh8n.s[3];

        if (err) {
          ++cov_ao7cemh8n.b[0][0];
          ++cov_ao7cemh8n.s[4];

          if (err.code === 'ENOENT') {
            ++cov_ao7cemh8n.b[1][0];
            ++cov_ao7cemh8n.s[5];

            reject(new Error(`${_Logger2.default.format.path(path)} does not exist`));
          } else {
              ++cov_ao7cemh8n.b[1][1];
              ++cov_ao7cemh8n.s[6];
              if (err.code === 'ENOTDIR') {
                ++cov_ao7cemh8n.b[2][0];
                ++cov_ao7cemh8n.s[7];

                reject(new Error(`${_Logger2.default.format.path(path)} is not a directory`));
              } else {
                ++cov_ao7cemh8n.b[2][1];
                ++cov_ao7cemh8n.s[8];

                reject(err);
              }
            }
        } else {
            ++cov_ao7cemh8n.b[0][1];
            ++cov_ao7cemh8n.s[9];
            if (files.filter(f => {
              ++cov_ao7cemh8n.f[3];
              ++cov_ao7cemh8n.s[10];
              return !IgnoredFiles.includes(f.toLowerCase());
            }).length > 0) {
              ++cov_ao7cemh8n.b[3][0];
              ++cov_ao7cemh8n.s[11];

              reject(new Error(`${_Logger2.default.format.path(path)} is not empty`));
            } else {
              ++cov_ao7cemh8n.b[3][1];
              ++cov_ao7cemh8n.s[12];

              resolve(path);
            }
          }
      });
    });
  }

  /**
   * Creates a an empty *package.json* file at the given path.
   * @param {String} path The location to create the package at.
   * @return {Promise<undefined, Error>} Rejected if an error occurred while writing the file.
   */
  createEmptyPackage(path) {
    ++cov_ao7cemh8n.f[4];
    ++cov_ao7cemh8n.s[13];

    return new Promise((resolve, reject) => {
      ++cov_ao7cemh8n.f[5];
      ++cov_ao7cemh8n.s[14];

      (0, _fs.writeFile)((0, _path.join)(path, 'package.json'), '{}', err => {
        ++cov_ao7cemh8n.f[6];
        ++cov_ao7cemh8n.s[15];

        if (err) {
          ++cov_ao7cemh8n.b[4][0];
          ++cov_ao7cemh8n.s[16];

          // FIXME: Call with SystemError class
          reject(Object.assign(err, {
            message: `Unable to create package.json at ${path}`,
            originalMessage: err.message
          }));
        } else {
          ++cov_ao7cemh8n.b[4][1];
          ++cov_ao7cemh8n.s[17];

          resolve();
        }
      });
    });
  }

  /**
   * Runs `npm install --save-dev {packages}` at the given path.
   * @param {String} path The path to install packages at.
   * @param {String|String[]} packages Names of the packages to install.
   * @return {Promise<undefined, Error>} Rejected if installing failed, resolved otherwise.
   */
  install(path, packages) {
    ++cov_ao7cemh8n.f[7];
    ++cov_ao7cemh8n.s[18];

    return new Promise((resolve, reject) => {
      ++cov_ao7cemh8n.f[8];
      ++cov_ao7cemh8n.s[19];

      (0, _which2.default)('npm', (err, npm) => {
        ++cov_ao7cemh8n.f[9];
        ++cov_ao7cemh8n.s[20];

        if (err) {
          ++cov_ao7cemh8n.b[5][0];
          ++cov_ao7cemh8n.s[21];

          reject(err);
        } else {
          ++cov_ao7cemh8n.b[5][1];

          const child = (++cov_ao7cemh8n.s[22], (0, _child_process.spawn)(npm, ['install', '--save-dev'].concat(packages), { cwd: path }).on('error', npmErr => {
            ++cov_ao7cemh8n.f[10];
            ++cov_ao7cemh8n.s[23];
            return reject(npmErr);
          }).on('close', code => {
            ++cov_ao7cemh8n.f[11];
            ++cov_ao7cemh8n.s[24];

            if (code > 0) {
              ++cov_ao7cemh8n.b[6][0];
              ++cov_ao7cemh8n.s[25];

              reject(new Error(`npm install returned code ${code}`));
            } else {
              ++cov_ao7cemh8n.b[6][1];
              ++cov_ao7cemh8n.s[26];

              resolve();
            }
          }));

          ++cov_ao7cemh8n.s[27];
          _Logger2.default.pipeLastLine(child.stdout);
        }
      });
    });
  }

  /**
   * Installs the local atscm module at the given path.
   * @param {String} path The path to install the module at.
   * @return {Promise<undefined, Error>} Rejected if installing failed, resolved otherwise.
   */
  installLocal(path) {
    ++cov_ao7cemh8n.f[12];
    ++cov_ao7cemh8n.s[28];

    _Logger2.default.info('Installing latest version of atscm...');

    // FIXME: call with (path, 'atscm') once atscm is published
    ++cov_ao7cemh8n.s[29];
    return this.install(path, 'atscm');
  }

  /**
   * Checks the version of this package against the "engines.atscm-cli" field of the newly installed
   * atscm module's package.json.
   * @param {Liftoff.Environment} env The environment to check.
   * @return {Liftoff.Environment} The environment to check.
   * @throws {Error} Throws an error if the atscm-cli version does not match.
   */
  checkCliVersion(env) {
    ++cov_ao7cemh8n.f[13];
    ++cov_ao7cemh8n.s[30];

    _Logger2.default.debug('Checking atscm-cli version...');

    const required = (++cov_ao7cemh8n.s[31], env.modulePackage.engines['atscm-cli']);
    ++cov_ao7cemh8n.s[32];
    if (!(0, _semver.satisfies)(_package2.default.version, required)) {
      ++cov_ao7cemh8n.b[7][0];
      ++cov_ao7cemh8n.s[33];

      _Logger2.default.info('Your version of atscm-cli is not compatible with the latest version atscm.');
      ++cov_ao7cemh8n.s[34];
      _Logger2.default.info('Please run', _Logger2.default.format.command('npm install -g atscm-cli'), 'to update.');

      ++cov_ao7cemh8n.s[35];
      throw new Error(`Invalid atscm-cli version: ${required} required.`);
    } else {
      ++cov_ao7cemh8n.b[7][1];
    }

    ++cov_ao7cemh8n.s[36];
    return env;
  }

  /**
   * Resolves the needed options from the local atscm module and asks for them. These options are
   * stored in the `atscm` module inside `out/init/options.js`.
   * @param {String} modulePath The path to the local module to use.
   * @return {Promise<Object, Error>} Resolved with the chosen options.
   */
  getOptions(modulePath) {
    ++cov_ao7cemh8n.f[14];
    ++cov_ao7cemh8n.s[37];

    _Logger2.default.info('Answer these questions to create a new project:');

    // eslint-disable-next-line global-require
    const options = (++cov_ao7cemh8n.s[38], require((0, _path.join)(modulePath, '../init/options')).default);

    ++cov_ao7cemh8n.s[39];
    return (0, _inquirer.prompt)(options);
  }

  /**
   * Runs the local atscm module's init script. This script is stored in the `atscm` module inside
   * `out/init/init.js`.
   * @param {String} modulePath The path to the local module to use.
   * @param {Object} options The options to apply (Received by calling
   * {@link InitCommand#getOptions}).
   * @return {Promise<{install: String[]}, Error>} Resolved with information on the further init
   * steps (e.g. which dependencies are needed), rejected with an error if running the init script
   * failed.
   */
  writeFiles(modulePath, options) {
    ++cov_ao7cemh8n.f[15];
    ++cov_ao7cemh8n.s[40];

    // eslint-disable-next-line global-require
    return require((0, _path.join)(modulePath, '../init/init')).default(options);
  }

  /**
   * Installs any additional dependencies needed after writing files.
   * @param {String} path The path to install the dependencies at.
   * @param {String[]} deps Names of the packages to install.
   * @return {Promise<undefined, Error>} Rejected if installing failed, resolved otherwise.
   */
  installDependencies(path, deps) {
    ++cov_ao7cemh8n.f[16];
    ++cov_ao7cemh8n.s[41];

    _Logger2.default.info('Installing dependencies...');

    ++cov_ao7cemh8n.s[42];
    return this.install(path, deps);
  }

  /**
   * Creates a new atscm project.
   * @param {AtSCMCli} cli The current Cli instance.
   */
  run(cli) {
    ++cov_ao7cemh8n.f[17];
    ++cov_ao7cemh8n.s[43];

    return cli.getEnvironment().then(env => {
      ++cov_ao7cemh8n.f[18];
      ++cov_ao7cemh8n.s[44];
      return this.checkDirectory(env.cwd);
    }).then(() => {
      ++cov_ao7cemh8n.f[19];
      ++cov_ao7cemh8n.s[45];
      return this.createEmptyPackage(cli.environment.cwd);
    }).then(() => {
      ++cov_ao7cemh8n.f[20];
      ++cov_ao7cemh8n.s[46];
      return this.installLocal(cli.environment.cwd);
    }).then(() => {
      ++cov_ao7cemh8n.f[21];
      ++cov_ao7cemh8n.s[47];
      return cli.getEnvironment();
    }).then(env => {
      ++cov_ao7cemh8n.f[22];
      ++cov_ao7cemh8n.s[48];
      return this.checkCliVersion(env);
    }).then(env => {
      ++cov_ao7cemh8n.f[23];
      ++cov_ao7cemh8n.s[49];
      return process.chdir(env.cwd);
    }).then(() => {
      ++cov_ao7cemh8n.f[24];
      ++cov_ao7cemh8n.s[50];
      return this.getOptions(cli.environment.modulePath);
    }).then(options => {
      ++cov_ao7cemh8n.f[25];
      ++cov_ao7cemh8n.s[51];
      return this.writeFiles(cli.environment.modulePath, Object.assign({}, cli.environment, options));
    }).then(result => {
      ++cov_ao7cemh8n.f[26];
      ++cov_ao7cemh8n.s[52];
      return this.installDependencies(cli.environment.cwd, result.install);
    }).then(() => {
      ++cov_ao7cemh8n.f[27];
      ++cov_ao7cemh8n.s[53];

      _Logger2.default.info('Created new project at', _Logger2.default.format.path(cli.environment.cwd));
    });
  }

  /**
   * This command never requires an {@link Liftoff.Environment}.
   * @return {Boolean} Always `false`.
   */
  requiresEnvironment() {
    ++cov_ao7cemh8n.f[28];
    ++cov_ao7cemh8n.s[54];

    return false;
  }

}
exports.default = InitCommand;